{"version":3,"sources":["../src/AbstractStore.js"],"names":[],"mappings":";;;;;;;;;;IAAa,aAAa,WAAb,aAAa;AACX,aADF,aAAa,CACV,EAAE,EAAE,OAAO,EAAE;8BADhB,aAAa;;AAElB,YAAI,CAAC,EAAE,GAAG,EAAE,CAAC;AACb,YAAI,CAAC,OAAO,GAAG,OAAO,CAAC;KAC1B;;iBAJQ,aAAa;AAMtB,YAAI;mBAAA,cAAC,MAAM,EAAE;AACT,uBAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACpC;;AAED,YAAI;mBAAA,cAAC,EAAE,EAAE;AACL,uBAAO,EAAE,CAAC;aACb;;AAEG,eAAO;iBAAA,YAAG;AACV,uBAAO,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,IAAI,IAAI,CAAC;aAC1C;;AAED,mBAAW;mBAAA,qBAAC,OAAO,EAAE;;;AACjB,oBAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AAC3B,oBAAI,CAAC,OAAO,CAAC,GAAG,EAAE;AACd,0BAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;iBACtD;AACD,uBAAO,CAAC,aAAa,GAAG,OAAO,CAAC,IAAI,KAAK,OAAO,CAAC,QAAQ,CAAC;AAC1D,uBAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;AACtB,uBAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC;AACxC,uBAAO,CAAC,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;AAC/C,uBAAO,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC7B,uBAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAC,KAAK,EAAK;AACxC,wBAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,CAAC,EAAE;AACpC,8BAAM,IAAI,KAAK,CAAC,wBAAwB,GACxB,MAAK,OAAO,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,GAAG,OAAO,CAAC,GAAG,GAAG,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,CAAC;qBACnF;iBACJ,CAAC,CAAC;aACN;;AAED,mBAAW;mBAAA,qBAAC,OAAO,EAAE;;;AACjB,oBAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AAC3B,oBAAI,CAAC,OAAO,CAAC,GAAG,EAAE;AACd,0BAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;iBACtD;AACD,uBAAO,CAAC,QAAQ,GAAG,EAAE,CAAC;AACtB,uBAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC;AACxC,uBAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAC,KAAK,EAAK;AACxC,wBAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,CAAC,EAAE;AACpC,8BAAM,IAAI,KAAK,CAAC,wBAAwB,GACxB,MAAK,OAAO,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,GAAG,OAAO,CAAC,GAAG,GAAG,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,CAAC;qBACnF;iBACJ,CAAC,CAAC;aACN;;;;WAjDQ,aAAa","file":"src/AbstractStore.js","sourcesContent":["export class AbstractStore {\n    constructor(db, manager) {\n        this.db = db;\n        this.manager = manager;\n    }\n\n    toVO(result) {\n        return this.manager.toVO(result);\n    }\n\n    toId(id) {\n        return id;\n    }\n\n    get keyPath() {\n        return this.manager.VO.keyPath || 'id';\n    }\n\n    updateByKey(options) {\n        var keyPath = this.keyPath;\n        if (!options.key) {\n            throw new Error('Missing property key in options');\n        }\n        options.partialUpdate = options.data !== options.fullData;\n        options.criteria = {};\n        options.criteria[keyPath] = options.key;\n        options.data = Object.assign({}, options.data);\n        delete options.data[keyPath];\n        return this.update(options).then((count) => {\n            if (count !== undefined && count !== 1) {\n                throw new Error('Failed to updateByKey ' +\n                                this.manager.VO.name + ': ' + options.key + ' (' + count + ')');\n            }\n        });\n    }\n\n    removeByKey(options) {\n        var keyPath = this.keyPath;\n        if (!options.key) {\n            throw new Error('Missing property key in options');\n        }\n        options.criteria = {};\n        options.criteria[keyPath] = options.key;\n        return this.remove(options).then((count) => {\n            if (count !== undefined && count !== 1) {\n                throw new Error('Failed to removeByKey ' +\n                                this.manager.VO.name + ': ' + options.key + ' (' + count + ')');\n            }\n        });\n    }\n}\n"]}